# Learn N Grow Admin

Admin dashboard for managing a coaching/tuition center: students, attendance, finance, user access, settings, and announcements.

## Features

- Dashboard with operational summaries
- Student management (add/edit/delete, teacher mapping, status, monthly fee)
- Attendance tracking
- Finance tracking (income/expense, payment status, CSV export)
- Role-based access management (`admin`, `students_only`)
- Login/logout with Supabase Auth
- Settings for profile, preferences, and data operations
- Announcements API endpoints

## Tech Stack

- Next.js 16 (App Router)
- React 18 + TypeScript
- Tailwind CSS + Radix UI primitives
- Supabase (Auth + Postgres + RLS)
- Recharts (charts/visuals)

## Routes

- `/` - Dashboard
- `/finance` - Finance module
- `/students` - Student + attendance module
- `/access-management` - User and role management
- `/agents` - AI agents module
- `/settings` - Profile/preferences/data
- `/login` - Authentication

## Environment Variables

Create a `.env.local` in project root:

```env
NEXT_PUBLIC_USE_SUPABASE=true
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key
```

Notes:

- `NEXT_PUBLIC_*` variables are exposed to the browser.
- `SUPABASE_SERVICE_ROLE_KEY` is server-only and used by API routes.
- If `NEXT_PUBLIC_USE_SUPABASE=false`, the app runs in mock-data mode and auth-gated features are disabled.

## Local Setup

1. Install dependencies:

```bash
npm install
```

2. Configure environment:

```bash
cp .env.example .env.local
```

Then update `.env.local` with real values.

3. Apply database schema in Supabase SQL editor:

- Run `supabase/schema.sql`
- (Optional) Run `supabase/seed.sql` for sample data

4. Start dev server:

```bash
npm run dev
```

Open `http://localhost:3000`.

## Announcements Table

The announcements API (`/api/announcements`) expects an `announcements` table. If you do not already have it, create it in Supabase:

```sql
create table if not exists public.announcements (
  id bigint generated by default as identity primary key,
  title text not null,
  message text not null,
  date date not null,
  created_at timestamptz not null default now()
);
```

## Admin Access Bootstrap

- Access management is restricted to `admin` role.
- If roles are missing, add/update an admin manually:

```sql
insert into public.app_user_roles (user_id, role, assigned_teachers)
values ('<USER_UUID>', 'admin', '{}'::text[])
on conflict (user_id)
do update
set role = 'admin', assigned_teachers = '{}'::text[], updated_at = now();
```

## Scripts

- `npm run dev` - Start development server
- `npm run build` - Build for production
- `npm run start` - Start production server
- `npm run lint` - Run ESLint
- `npm run typecheck` - Run TypeScript type checking

## Deploy to Vercel

1. Link project:

```bash
vercel link
```

2. Add all required env vars in Vercel for `Production`, `Preview`, and `Development`.

3. Deploy:

```bash
vercel deploy -y --target preview
vercel deploy --prod -y
```

## Troubleshooting

- `Enable Supabase auth to manage user access.` on Access Management:
  - `NEXT_PUBLIC_USE_SUPABASE` is not `true` or Supabase URL/key is missing in that environment.
- Logout button not visible:
  - Auth is disabled in current environment (same root cause as above).
- `Only admins can manage user access`:
  - Logged-in user exists but has no `admin` role in `app_user_roles`.

